---
### By ID
- name: get info about qradar offense
  rule_info:
    name: "Service DoS Attack Detected"
  register: rule_info

- debug: var=rule_info

- name: enable rule by id
  rule:
    state: enabled
    id: "{{ rule_info['rules'][0]['id']|int }}"
  register: enable_rule_by_id

- name: ensure enable rule by id
  assert:
    that:
      - enable_rule_by_id is changed
      - enable_rule_by_id is not failed

- name: enable rule by id again
  rule:
    state: enabled
    id: "{{ rule_info['rules'][0]['id']|int }}"
  register: enable_rule_by_id_again

- name: ensure enable rule by id again
  assert:
    that:
      - enable_rule_by_id_again is not changed
      - enable_rule_by_id_again is not failed

- name: disable rule by id
  rule:
    state: disabled
    id: "{{ rule_info['rules'][0]['id']|int }}"
  register: disable_rule_by_id

- name: ensure disable rule by id
  assert:
    that:
      - disable_rule_by_id is changed
      - disable_rule_by_id is not failed

- name: disable rule by id again
  rule:
    state: disabled
    id: "{{ rule_info['rules'][0]['id']|int }}"
  register: disable_rule_by_id_again

- name: ensure disable rule by id again
  assert:
    that:
      - disable_rule_by_id_again is not changed
      - disable_rule_by_id_again is not failed

### By Name 
- name: enable rule by name
  rule:
    state: enabled
    name: "Service DoS Attack Detected"
  register: enable_rule_by_name

- name: ensure enable rule by name
  assert:
    that:
      - enable_rule_by_name is changed
      - enable_rule_by_name is not failed

- name: enable rule by name again
  rule:
    state: enabled
    name: "Service DoS Attack Detected"
  register: enable_rule_by_name_again

- name: ensure enable rule by name again
  assert:
    that:
      - enable_rule_by_name_again is not changed
      - enable_rule_by_name_again is not failed

- name: disable rule by name
  rule:
    state: disabled
    name: "Service DoS Attack Detected"
  register: disable_rule_by_name

- name: ensure disable rule by name
  assert:
    that:
      - disable_rule_by_name is changed
      - disable_rule_by_name is not failed

- name: disable rule by name again
  rule:
    state: disabled
    name: "Service DoS Attack Detected"
  register: disable_rule_by_name_again

- name: ensure disable rule by name again
  assert:
    that:
      - disable_rule_by_name_again is not changed
      - disable_rule_by_name_again is not failed
